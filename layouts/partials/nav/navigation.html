{{/* Check https://github.com/bep/hugotest */}}
{{ $root := (.Site.GetPage "section" .Section) }}
<ul>
  {{ with $root -}}
  <li><a href="{{ $root.RelPermalink}}">{{ if .LinkTitle }}{{ .LinkTitle }}{{ else }}{{ .Title }}{{ end }}</a></li>
  {{ template "section-tree-nav"  (dict "root" $root "current" $ ) -}}
  {{ range .Pages }}
    <li><a href="{{ .RelPermalink}}">{{ if .LinkTitle }}{{ .LinkTitle }}{{ else }}{{ .Title }}{{ end }}</a></li>
  {{ end }}
  {{ end -}}
</ul>

{{ define "section-tree-nav" }}
  {{ range .root.Sections}}
  	{{ $pages := where .Pages ".Params.hidden" "!=" "true" }}
    {{ $sections := len .Sections }}
    {{ $submenus := add $sections (len $pages) }}
    <li><a href="{{ .RelPermalink}}">{{ if .LinkTitle }}{{ .LinkTitle }}{{ else }}{{ .Title }}{{ end }}</a>
      {{ if gt $submenus 0 }}
      <ul>
        {{ range $pages -}}
        	<li><a href="{{ .RelPermalink}}">{{ if .LinkTitle }}{{ .LinkTitle }}{{ else }}{{ .Title }}{{ end }}</a></li>
        {{ end -}}
        {{ template "section-tree-nav" (dict "root" . "current" $.current ) -}}
      </ul>
      {{ end }}
    </li>
  {{ end -}}
{{ end -}}
